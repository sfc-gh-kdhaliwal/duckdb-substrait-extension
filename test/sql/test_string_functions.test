# name: test/sql/test_string_functions.test
# description: Test Substrait generation for string functions
# group: [sql]

require substrait

# =============================================================================
# Setup
# =============================================================================

statement ok
CREATE TABLE strings (id INT, s VARCHAR)

statement ok
INSERT INTO strings VALUES (1, 'Hello'), (2, 'World'), (3, 'hello world'), (4, NULL)

# =============================================================================
# Test 1: CONCAT
# =============================================================================

statement ok
CALL get_substrait('SELECT CONCAT(s, '' suffix'') FROM strings')

# =============================================================================
# Test 2: String concatenation operator
# =============================================================================

statement ok
CALL get_substrait('SELECT s || '' suffix'' FROM strings')

# =============================================================================
# Test 3: UPPER and LOWER
# =============================================================================

statement ok
CALL get_substrait('SELECT UPPER(s), LOWER(s) FROM strings')

# =============================================================================
# Test 4: SUBSTRING
# =============================================================================

statement ok
CALL get_substrait('SELECT SUBSTRING(s, 1, 3) FROM strings')

# =============================================================================
# Test 5: LEFT and RIGHT
# =============================================================================

statement ok
CALL get_substrait('SELECT LEFT(s, 2), RIGHT(s, 2) FROM strings')

# =============================================================================
# Test 6: TRIM, LTRIM, RTRIM
# =============================================================================

statement ok
CALL get_substrait('SELECT TRIM(s), LTRIM(s), RTRIM(s) FROM strings')

# =============================================================================
# Test 7: LENGTH
# =============================================================================

statement ok
CALL get_substrait('SELECT LENGTH(s) FROM strings')

# =============================================================================
# Test 8: REPLACE
# =============================================================================

statement ok
CALL get_substrait('SELECT REPLACE(s, ''o'', ''0'') FROM strings')

# =============================================================================
# Test 9: LIKE pattern
# =============================================================================

statement ok
CALL get_substrait('SELECT s FROM strings WHERE s LIKE ''%world%''')

# =============================================================================
# Test 10: LIKE with wildcard
# =============================================================================

statement ok
CALL get_substrait('SELECT s FROM strings WHERE s LIKE ''H___o''')

# =============================================================================
# Test 11: ILIKE (case insensitive)
# =============================================================================

statement ok
CALL get_substrait('SELECT s FROM strings WHERE s ILIKE ''%WORLD%''')

# =============================================================================
# Test 12: String comparison
# =============================================================================

statement ok
CALL get_substrait('SELECT s FROM strings WHERE s > ''Hello''')

# =============================================================================
# Cleanup
# =============================================================================

statement ok
DROP TABLE strings
